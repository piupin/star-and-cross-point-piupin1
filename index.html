<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Stars / Naughty Points</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #fff8e1;
        color: #333;
        transition: background 0.3s, color 0.3s;
    }
    .naughty-mode {
        background: #1a0000;
        color: #ff4d4d;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        padding: 8px;
        border-bottom: 1px solid #ccc;
        text-align: left;
    }
    th {
        background: #ffeb3b;
    }
    .naughty-mode th {
        background: #660000;
        color: #fff;
    }
    .switch-container {
        padding: 10px;
    }
</style>
</head>
<body>

<div class="switch-container">
    <label>
        <input type="checkbox" id="modeSwitch"> Naughty Mode ‚ò†Ô∏è
    </label>
</div>

<table>
    <thead>
        <tr>
            <th>No.</th>
            <th>Name</th>
            <th id="pointsHeader">Stars</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody id="dataBody"></tbody>
</table>

<script>
const sheetURL = "https://docs.google.com/spreadsheets/d/1dpFvFkYwTw4B8laeTQ21mrN78w5P97W3wohI7Pa_2pk/gviz/tq?tqx=out:json";
const modeSwitch = document.getElementById("modeSwitch");
const dataBody = document.getElementById("dataBody");
const pointsHeader = document.getElementById("pointsHeader");

let studentsData = [];

function fetchData() {
    fetch(sheetURL)
        .then(res => res.text())
        .then(text => {
            const json = JSON.parse(text.substr(47).slice(0, -2));
            studentsData = json.table.rows.map((row, i) => ({
                name: row.c[1] ? row.c[1].v : "",
                stars: row.c[2] ? parseInt(row.c[2].v) : 0,
                naughty: row.c[5] ? parseInt(row.c[5].v) : 0
            }));
            renderTable();
        });
}

function renderTable() {
    const isNaughty = modeSwitch.checked;
    pointsHeader.textContent = isNaughty ? "Naughty Points" : "Stars";

    let sortedData = [...studentsData];
    sortedData.sort((a, b) => {
        return isNaughty ? b.naughty - a.naughty : b.stars - a.stars;
    });

    dataBody.innerHTML = "";
    sortedData.forEach((student, index) => {
        let medal = "";
        if (index === 0) medal = isNaughty ? "‚ò†Ô∏è" : "ü•á";
        else if (index === 1) medal = isNaughty ? "üíÄ" : "ü•à";
        else if (index === 2) medal = isNaughty ? "ü¶¥" : "ü•â";

        let points = isNaughty ? student.naughty : student.stars;
        let row = `<tr>
            <td>${medal || index + 1}</td>
            <td>${student.name}</td>
            <td>${points}</td>
            <td>${points}</td>
        </tr>`;
        dataBody.innerHTML += row;
    });

    document.body.classList.toggle("naughty-mode", isNaughty);
}

modeSwitch.addEventListener("change", renderTable);

fetchData();
</script>

</body>
</html>
