<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stars</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#FFD700" />
  <style>
    :root{
      --bg:#fff8e1;
      --card:#ffffff;
      --head:#ffeb3b;
      --border:#ffcc80;
      --text:#333;
      --hover:#ffe082;
      --shadow:0 4px 8px rgba(0,0,0,.2);
    }
    body.naughty {
      --bg:#0a0a0a;
      --card:#121212;
      --head:#2a0000;
      --border:#3a0000;
      --text:#f8d7da;
      --hover:#1a0000;
      --shadow:0 6px 14px rgba(255,0,0,.15);
    }*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family: "Comic Sans MS", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
  padding:12px;
  transition:background .25s ease, color .25s ease;
}
body.menu-open{ overflow:hidden; }

.topbar{
  width:100%;
  max-width:720px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:sticky;
  top:0;
  padding:8px 6px;
  backdrop-filter:saturate(140%) blur(6px);
  z-index:10;
}

h1{
  margin:0 0 6px 0;
  font-size:1.6rem;
  color:#ff5722;
  transition:color .25s ease;
  user-select:none;
  cursor:pointer;
}
body.naughty h1{ color:#ff3b3b; }

.title-right{ display:flex; align-items:center; gap:4px; }

.switch-wrap{ display:flex; align-items:center; gap:8px; }
.mode-label{ font-size:.95rem; user-select:none; }
.switch{ position:relative; width:58px; height:30px; }
.switch input{ display:none; }
.slider{
  position:absolute; inset:0; background:#ffd54f; border-radius:999px;
  box-shadow:inset 0 2px 6px rgba(0,0,0,.25);
  transition:background .25s ease;
}
.knob{
  position:absolute; top:3px; left:3px; width:24px; height:24px; border-radius:50%;
  background:#fff; display:flex; align-items:center; justify-content:center;
  font-size:15px; transition:transform .25s ease;
  box-shadow:0 2px 6px rgba(0,0,0,.25);
}
input:checked + .slider{ background:#8b0000; }
input:checked + .slider .knob{ transform:translateX(28px); }

.table-wrap{
  width:100%; max-width:720px; background:var(--card);
  border-radius:12px; overflow:hidden; box-shadow:var(--shadow);
}
table{ width:100%; border-collapse:collapse; background:var(--card); }
thead th{
  background:var(--head); color:#333; text-align:center;
  padding:10px; font-weight:700;
}
tbody td{
  border-top:2px solid var(--border);
  padding:10px; font-size:16px; text-align:center;
}
tbody tr:nth-child(even){ background:rgba(255,255,255,.35); }
body.naughty tbody tr:nth-child(even){ background:#151515; }
tbody tr:hover{ background:var(--hover); }

th:nth-child(1), td:nth-child(1){ width:40px; }
th:nth-child(2), td:nth-child(2){
  width:32%;
  text-align:left;
  word-break:break-word;
  white-space:normal;
}
th:nth-child(3), td:nth-child(3){ width:auto; text-align:left; word-break:break-word; font-size:20px; }
th:nth-child(4), td:nth-child(4){ width:64px; }

.badge{
  margin:6px 0 2px; padding:6px 10px; border-radius:999px; font-weight:700; font-size:.9rem;
  background:#fff3cd; color:#795548; display:inline-flex; align-items:center; gap:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}
body.naughty .badge{ background:#330000; color:#ffb3b3; }

.empty{ padding:18px; text-align:center; opacity:.8; }

.notice-wrap{
  width:100%; max-width:720px;
  background:var(--card);
  border-radius:10px;
  box-shadow:var(--shadow);
  margin-top:12px;
  padding:10px 14px;
}
.notice-wrap h2{
  margin:0 0 6px;
  font-size:1.1rem;
  color:#d32f2f;
}
body.naughty .notice-wrap h2{ color:#ff6666; }
.notice-item{ margin:4px 0; font-size:.95rem; line-height:1.3; }

.update-banner {
  display:none;
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#4caf50;
  color:#fff;
  padding:10px 18px;
  border-radius:8px;
  font-size:.95rem;
  box-shadow:0 2px 6px rgba(0,0,0,.3);
  z-index:1000;
  animation:fadeIn .4s ease;
}
.update-banner.show{ display:block; }
@keyframes fadeIn{
  from{ opacity:0; transform:translate(-50%,20px);}
  to{ opacity:1; transform:translate(-50%,0);}
}

.more-btn{
  border:none; background:transparent;
  font-size:22px; cursor:pointer;
  padding:8px; border-radius:10px;
}
.more-btn:active{ transform:scale(.96); }

.overlay{
  position:fixed; inset:0; display:none;
  backdrop-filter:blur(6px);
  background:rgba(0,0,0,.2);
  z-index:999;
}
.overlay.show{ display:block; }

.drawer{
  position:fixed;
  top:0; right:0;
  height:100vh;
  width:75vw; max-width:520px; min-width:300px;
  background:var(--card);
  box-shadow:-8px 0 20px rgba(0,0,0,.25);
  transform:translateX(100%);
  transition:transform .28s ease;
  z-index:1000;
  display:flex; flex-direction:column;
}
.drawer.open{ transform:translateX(0%); }

.drawer-header{
  display:flex; align-items:center; justify-content:space-between;
  padding:12px 14px; border-bottom:2px solid var(--border);
  background:var(--head);
}
.drawer-content{
  padding:10px 14px;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  flex:1;
}

.group{ border:2px solid var(--border); border-radius:10px; margin:10px 0; background:var(--card);}
.group-header{
  width:100%; background:rgba(0,0,0,.04);
  border:none; padding:10px 12px; font-weight:700;
  cursor:pointer; display:flex; justify-content:space-between; align-items:center;
}
.group-body{ display:none; padding:10px 12px; }
.group-body.show{ display:block; }

.mat-subject{ margin:8px 0 4px; font-weight:800; }
.mat-list{ list-style:none; padding:0; margin:0 0 10px 0; }
.mat-list li a{
  display:block; padding:8px 10px; margin:6px 0;
  background:rgba(0,0,0,.04); border-radius:8px; text-decoration:none; color:inherit;
  word-break:break-word;
}
.mat-list li a:active{ transform:scale(.98); }

.plan-list{ list-style:decimal; padding:0 0 0 18px; margin:0;}
.plan-list li{ padding:6px 4px; border-bottom:1px dashed var(--border);}
.teacher-actions{ display:none; margin-top:10px; gap:8px; flex-wrap:wrap;}
.teacher-actions.show{ display:flex; }
.teacher-actions button{
  padding:8px 10px; border-radius:10px;
  border:2px solid var(--border); background:var(--head); font-weight:700; cursor:pointer;
}
.teacher-actions button:active{ transform:scale(.98); }

footer{ margin-top:20px; font-size:0.8rem; color:#888; text-align:center; opacity:.7; }

  </style>
</head>
<body>
  <div class="topbar">
    <div class="switch-wrap">
      <label class="switch">
        <input id="modeToggle" type="checkbox" aria-label="Toggle Naughty Mode">
        <div class="slider"><div class="knob">ðŸŒŸ</div></div>
      </label>
      <span class="mode-label" id="modeLabel">Stars</span>
    </div><div class="title-right">
  <h1 id="appTitle">Student Points</h1>
  <button class="more-btn" id="moreBtn" aria-label="Open menu">â‹®</button>
</div>

  </div>  <div class="badge" id="modeBadge">ðŸŒŸ Stars Ranking</div>  <div class="table-wrap">
    <table id="studentTable">
      <thead>
        <tr>
          <th>No.</th>
          <th>Name</th>
          <th id="pointsHeader">Stars</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody><tr><td class="empty" colspan="4">Loadingâ€¦</td></tr></tbody>
    </table>
  </div>  <div class="notice-wrap" id="noticeSection">
    <h2 id="noticeTitle">Notices</h2>
    <div id="noticeList">Loadingâ€¦</div>
  </div>  <div id="menuOverlay" class="overlay"></div>
  <aside id="sideMenu" class="drawer" aria-hidden="true">
    <div class="drawer-header">
      <strong>Menu</strong>
      <button id="closeMenuBtn" class="more-btn" aria-label="Close menu">âœ•</button>
    </div>
    <div class="drawer-content">
      <div class="group">
        <button class="group-header" data-target="#materialsBody">
          Study Materials <span>â–¾</span>
        </button>
        <div id="materialsBody" class="group-body">
          <div style="opacity:.7;">Loadingâ€¦</div>
        </div>
      </div><div class="group">
    <button class="group-header" data-target="#sitBody">
      Sit Plan <span>â–¾</span>
    </button>
    <div id="sitBody" class="group-body">
      <ol id="sitList" class="plan-list"></ol>
      <div id="teacherActions" class="teacher-actions">
        <button id="shuffleBtn">Shuffle (Temporary)</button>
        <button id="copyBtn">Copy Sit Plan</button>
      </div>
      <div id="sitHint" style="margin-top:8px; opacity:.7; font-size:.9rem;"></div>
    </div>
  </div>
</div>

  </aside>  <div class="update-banner" id="updateBanner">âœ… App updated to latest version</div>  <footer>Made by Piu</footer>  <script>
    const mainSheetID   = "1dpFvFkYwTw4B8laeTQ21mrN78w5P97W3wohI7Pa_2pk";
    const mainSheetName = "Sheet1";
    const pdfSheetID    = "1HFAC0O7INymniAzrQarBPK8Jfyg3lTWBzg22cxg2wVg";
    const pdfSheetName  = "Materials";

    const studentQuery  = encodeURIComponent("SELECT A,B,F,M,P");
    const studentsURL   = `https://docs.google.com/spreadsheets/d/${mainSheetID}/gviz/tq?sheet=${mainSheetName}&tq=${studentQuery}`;

    const passURL       = `https://docs.google.com/spreadsheets/d/${mainSheetID}/gviz/tq?sheet=${mainSheetName}&range=W1:W1`;

    const seatQuery     = encodeURIComponent("SELECT I");
    const seatsURL      = `https://docs.google.com/spreadsheets/d/${mainSheetID}/gviz/tq?sheet=${mainSheetName}&tq=${seatQuery}`;

    const matQuery      = encodeURIComponent("SELECT A,B,C");
    const materialsURL  = `https://docs.google.com/spreadsheets/d/${pdfSheetID}/gviz/tq?sheet=${pdfSheetName}&tq=${matQuery}`;

    const tbody = document.querySelector("#studentTable tbody");
    const modeToggle = document.querySelector("#modeToggle");
    const modeLabel  = document.querySelector("#modeLabel");
    const modeBadge  = document.querySelector("#modeBadge");
    const pointsHeader = document.querySelector("#pointsHeader");
    const knob = document.querySelector(".knob");
    const noticeTitle = document.getElementById("noticeTitle");
    const noticeList = document.getElementById("noticeList");
    const appTitle = document.getElementById("appTitle");

    const moreBtn = document.getElementById("moreBtn");
    const sideMenu = document.getElementById("sideMenu");
    const menuOverlay = document.getElementById("menuOverlay");
    const closeMenuBtn = document.getElementById("closeMenuBtn");

    const materialsBody = document.getElementById("materialsBody");
    const sitBody = document.getElementById("sitBody");
    const sitList = document.getElementById("sitList");
    const teacherActions = document.getElementById("teacherActions");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const sitHint = document.getElementById("sitHint");
    const copyBtn = document.getElementById("copyBtn");

    let dataRows = [];
    let currentMode = "stars";
    let teacherPassword = "";
    let seatNames = [];
    let teacherMode = false;
    let materialsRows = [];

    function parseGViz(text){
      const json = JSON.parse(text.substr(47).slice(0, -2));
      return json.table?.rows || [];
    }

    function countEmojis(str, emojiRegex){
      if (!str) return 0;
      const m = str.match(emojiRegex);
      return m ? m.length : 0;
    }

    function openMenu(){
      sideMenu.classList.add("open");
      menuOverlay.classList.add("show");
      document.body.classList.add("menu-open");
    }
    function closeMenu(){
      sideMenu.classList.remove("open");
      menuOverlay.classList.remove("show");
      document.body.classList.remove("menu-open");
    }

    function toggleGroup(btn){
     