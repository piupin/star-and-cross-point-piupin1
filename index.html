<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Stars & Naughty List</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #fff8e1;
        margin: 0;
        padding: 0;
    }
    header {
        background: #FFD700;
        padding: 10px;
        display: flex;
        align-items: center;
    }
    label {
        font-weight: bold;
        margin-left: 10px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
    }
    th, td {
        border: 1px solid #ccc;
        padding: 8px;
    }
    th {
        background: #fdd835;
    }
    .naughty-mode {
        background-color: #1c1c1c;
        color: white;
    }
    .naughty-mode th {
        background: #ff1744;
    }
</style>
</head>
<body>
    <header>
        <input type="checkbox" id="modeSwitch">
        <label for="modeSwitch">Show Naughty List</label>
    </header>
    <table id="dataTable">
        <thead>
            <tr>
                <th>No.</th>
                <th>Name</th>
                <th id="pointsHeader">Stars</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
const sheetId = "1dpFvFkYwTw4B8laeTQ21mrN78w5P97W3wohI7Pa_2pk";
const sheetURL = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

const tableBody = document.querySelector("#dataTable tbody");
const pointsHeader = document.getElementById("pointsHeader");
const modeSwitch = document.getElementById("modeSwitch");

let data = [];

function fetchData() {
    fetch(sheetURL)
        .then(res => res.text())
        .then(raw => {
            const json = JSON.parse(raw.substr(47).slice(0, -2));
            const rows = json.table.rows;

            data = rows.map((row, index) => ({
                no: index + 1,
                name: row.c[1] ? row.c[1].v : "",
                stars: row.c[2] ? row.c[2].v : 0,
                naughty: row.c[5] ? row.c[5].v : 0
            }));

            renderTable(false);
        })
        .catch(err => console.error("Error loading data:", err));
}

function renderTable(naughtyMode) {
    tableBody.innerHTML = "";

    let sortedData;
    if (naughtyMode) {
        sortedData = [...data].sort((a, b) => b.naughty - a.naughty);
        pointsHeader.textContent = "Naughty Points";
        document.body.classList.add("naughty-mode");
    } else {
        sortedData = [...data].sort((a, b) => b.stars - a.stars);
        pointsHeader.textContent = "Stars";
        document.body.classList.remove("naughty-mode");
    }

    sortedData.forEach((student, index) => {
        let medal = "";
        if (!naughtyMode) {
            if (index === 0) medal = "ü•á";
            else if (index === 1) medal = "ü•à";
            else if (index === 2) medal = "ü•â";
        } else {
            if (index === 0) medal = "‚ò†Ô∏è";
            else if (index === 1) medal = "üíÄ";
            else if (index === 2) medal = "ü¶¥";
        }

        const points = naughtyMode ? student.naughty : student.stars;

        const row = `
            <tr>
                <td>${student.no}</td>
                <td>${student.name}</td>
                <td>${medal} ${points}</td>
            </tr>
        `;
        tableBody.innerHTML += row;
    });
}

modeSwitch.addEventListener("change", () => {
    renderTable(modeSwitch.checked);
});

fetchData();
</script>
</body>
</html>
